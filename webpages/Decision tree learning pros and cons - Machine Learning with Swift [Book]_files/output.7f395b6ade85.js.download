!function(e){function webpackJsonpCallback(t){for(var n,i,o=t[0],l=t[1],c=t[2],u=0,d=[];u<o.length;u++)i=o[u],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&d.push(r[i][0]),r[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(s&&s(t);d.length;)d.shift()();return a.push.apply(a,c||[]),checkDeferredModules()}function checkDeferredModules(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,o=1;o<n.length;o++){var s=n[o];0!==r[s]&&(i=!1)}i&&(a.splice(t--,1),e=__webpack_require__(__webpack_require__.s=n[0]))}return e}var t={},r={1:0},a=[];function __webpack_require__(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,__webpack_require__),a.l=!0,a.exports}__webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(__webpack_require__.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)__webpack_require__.d(r,a,function(t){return e[t]}.bind(null,a));return r},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="/anybird/static/build/";var n=window.webpackJsonp=window.webpackJsonp||[],i=n.push.bind(n);n.push=webpackJsonpCallback,n=n.slice();for(var o=0;o<n.length;o++)webpackJsonpCallback(n[o]);var s=i;a.push([603,0]),checkDeferredModules()}({603:function(e,t,r){r(212),e.exports=r(781)},703:function(e,t){},705:function(e,t){},738:function(e,t){},739:function(e,t){},781:function(e,t,r){"use strict";r.r(t);r(604);var a=r(1),n=r.n(a),i=r(327),o=r(147),s=r.n(o),l=r(46),c=r.n(l),u=function(e){var t=e.children,r=e.universityLogo;return n.a.createElement("div",{className:"backdrop"},n.a.createElement("div",{className:"modal ".concat(e.className)},n.a.createElement("div",{className:"header"},r?n.a.createElement("img",{className:"uni-logo",src:r,alt:"University logo"}):"",n.a.createElement("img",{className:"brand-logo",src:"https://cdn.oreillystatic.com/images/sitewide-headers/oreilly_logo_mark_red.svg",alt:"Oâ€™Reilly"})),n.a.createElement("div",{className:"content"},t)))};u.propTypes={children:c.a.oneOfType([c.a.arrayOf(c.a.node),c.a.node]),className:c.a.string,universityLogo:c.a.string};var d=u;function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var r,a=_getPrototypeOf(e);if(t){var n=_getPrototypeOf(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return function(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;return _assertThisInitialized(e)}(this,r)}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=r(698),h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}(StudentIntercept,a["Component"]);var t,r,i,o=_createSuper(StudentIntercept);function StudentIntercept(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,StudentIntercept),t=o.call(this,e);var r=new s.a(window.location.search);return t.state={show:!1,universityLogo:"",uiState:e.federatedAuthEnabled?"federated":"capture",email:r.get("email")||"",timestamp:r.get("tstamp")||"",signature:r.get("id")||"",error:"",federatedInstitution:"",mlfaIDPProviders:"",accountIdentifier:"",ipAuth:!1,referrerAuth:!1,idProviders:[],chosenIdProvider:""},e.accountIdentifier?(t.state.accountIdentifier=e.accountIdentifier,t.state.referrerAuth=!0,t.state.uiState="referrerVerified",t.state.show=!0):t.get(t.fullLearningURL("/api/v1/account-summary-by-network/")).then(function(e){e.identifier&&!0===e.allow_ip_based_authentication&&(t.state.accountIdentifier=e.identifier,t.state.ipAuth=!0,t.state.uiState="ipVerified");var r=t.state.uiState;if(e.headers){var a=e.headers.get("X-EZP-User")||"";a&&(t.state.email=a)}t.state.email&&t.state.timestamp&&t.state.signature?(r="ezproxy-sso",t.registerUser()):e.sso_login_url&&(r="sso");var n={show:!0,universityLogo:e.logo,uiState:r};t.setState(n)}).catch(function(){t.props.forceShow&&t.setState({show:!0})}),t.determineSsoStatus=t.determineSsoStatus.bind(_assertThisInitialized(t)),t.handleFederatedSelectionChange=t.handleFederatedSelectionChange.bind(_assertThisInitialized(t)),t.handleInputChange=t.handleInputChange.bind(_assertThisInitialized(t)),t.handleInstitutionNotListed=t.handleInstitutionNotListed.bind(_assertThisInitialized(t)),t.registerTemporaryUser=t.registerTemporaryUser.bind(_assertThisInitialized(t)),t.registerUser=t.registerUser.bind(_assertThisInitialized(t)),t.handleIdProviderSelection=t.handleIdProviderSelection.bind(_assertThisInitialized(t)),t.redirectToChosenIdProvider=t.redirectToChosenIdProvider.bind(_assertThisInitialized(t)),t}return t=StudentIntercept,(r=[{key:"componentDidMount",value:function(){var e=this;if("federated"===this.state.uiState){var t=function(e){switch(e){case"production":return"com";case"qa":return"review";default:return"local"}}(this.props.env);this.setState({tld:t}),this.get("/library/view/api/mlfa-idp-list/").then(function(t){if(!e.state.ipAuth){var r=JSON.parse(t);e.setState({mlfaIDPProviders:r}),e.setState({uiState:"federated"})}}).catch(function(){e.state.ipAuth||e.setState({uiState:"capture"})})}}},{key:"handleInputChange",value:function(e){this.setState({email:e.target.value})}},{key:"handleFederatedSelectionChange",value:function(e){var t=this.getNextURLValue(),r=e.target.value;this.setState({federatedInstitution:r});var a="https://learning.oreilly.".concat(this.state.tld,"/accounts/login-academic-check/?next=").concat(t,"&idp-slug=").concat(r);this.setState({targetUrl:a})}},{key:"handleInstitutionNotListed",value:function(){this.setState({uiState:"capture"})}},{key:"returnWindowPathName",value:function(){return window.location.pathname}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return fetch(e,{method:"GET",credentials:"same-origin"}).then(function(e){if(!e.ok){var r=new Error(e.statusText);throw r.response=e,r}return t?e.text():e.json()})}},{key:"post",value:function(e,t,r){return fetch(e,{method:"POST",body:JSON.stringify(t),credentials:r,headers:{"Content-Type":"application/json"}}).then(function(e){if(!e.ok){if(422===e.status)return e.json().then(function(e){var t=new Error;throw t.response=e,t});throw new Error(e.statusText)}return e.json()})}},{key:"redirectToSsoLoginUrl",value:function(e){var t=e.includes("?")?"&":"?",r=encodeURIComponent(this.props.readingUrl);window.location.replace("".concat(e).concat(t,"state=").concat(r))}},{key:"fullLearningURL",value:function(e){return"www.oreilly.com"===window.location.hostname?"https://learning.oreilly.com".concat(e):"www.oreilly.review"===window.location.hostname?"https://learning.oreilly.review".concat(e):e}},{key:"fullAPIUrl",value:function(e){return"www.oreilly.com"===window.location.hostname?"https://api.oreilly.com".concat(e):"www.oreilly.review"===window.location.hostname?"https://api.oreilly.review".concat(e):"www.oreilly.local"===window.location.hostname?"https://api.oreilly.review".concat(e):e}},{key:"getCredentials",value:function(){return"www.oreilly.com"===window.location.hostname||"www.oreilly.review"===window.location.hostname?"include":"same-origin"}},{key:"getNextURLValue",value:function(){var e=window.location.pathname;return e.includes("temporary-access")?"/home/":e}},{key:"determineSsoStatus",value:function(){var e=this,t=this.state,r=t.email,a=(t.ipAuth,this.fullAPIUrl("/api/v1/auth/identity-provider-lookup/")),n={email:r},i=this.getCredentials();this.setState({uiState:"loading"}),this.post(a,n,i).then(function(t){var r,a=null===t||void 0===t?void 0:t.identity_providers;if(Array.isArray(a)&&a.length>0){if(a.length>1)return e.setState({uiState:"showIdProviderSelector",idProviders:a}),!0;var n;r=null===(n=a[0])||void 0===n?void 0:n.sso_link_base_url}r?e.redirectToSsoLoginUrl(r):e.registerUser()}).catch(function(t){e.registerUser()})}},{key:"registerUser",value:function(){var e=this,t=this.state,r=t.accountIdentifier,a=t.email,n=t.ipAuth,i=t.signature,o={email:a,timestamp:t.timestamp,signature:i};r&&(o.account_identifier=r),this.props.forceShow&&(o.ar=!0),this.setState({uiState:"loading"}),this.post(this.fullLearningURL("/api/v1/registration/academic/"),o,this.getCredentials()).then(function(){e.setState({uiState:"success"})}).catch(function(t){if(t.response){var r=t.response.email||t.response.non_field_errors||"";e.setState({error:r,uiState:n?"failure":"capture"})}else e.setState({error:"",uiState:"failure"})})}},{key:"registerTemporaryUser",value:function(){var e=this.state,t=e.email,r=e.accountIdentifier;!t&&r&&(this.state.email="".concat(m.randomBytes(32).toString("hex"),"@").concat(r,".com")),this.registerUser()}},{key:"renderEmailEntry",value:function(){var e=this.state,t=e.universityLogo,r=e.email,a=e.uiState,i=e.error;e.csrfToken;return n.a.createElement(d,{universityLogo:t},n.a.createElement("div",{className:"attention"},n.a.createElement("p",null,"Welcome! Get instant access through ",n.a.createElement("span",{className:"nowrap"},"your library."))),n.a.createElement("div",{className:"messaging"},n.a.createElement("p",{className:"label"},"Your academic email:"),n.a.createElement("div",{className:"input-container".concat(i?" error":"")},n.a.createElement("input",{type:"text",name:"email",placeholder:"username@institutionname.edu",value:r,onChange:this.handleInputChange,ref:function(e){return e&&e.focus()}})),i?n.a.createElement("small",{className:"error"},i):"",n.a.createElement("p",{className:"institutionLink"},n.a.createElement("a",{href:this.props.signInUrl},"Already a user?")),this.renderPrivacyPolicy()),n.a.createElement("div",{className:"buttonBox"},"loading"===a?n.a.createElement("img",{className:"spinner",src:"/library/view/static/images/loading.gif",alt:""}):n.a.createElement("button",{className:"cta",onClick:this.determineSsoStatus},"Let's Go")))}},{key:"renderTempVerified",value:function(){var e=this.state,t=e.uiState,r=e.universityLogo;return n.a.createElement(d,{className:"ipVerified",universityLogo:r},n.a.createElement("div",{className:"attention"},n.a.createElement("p",null,"Welcome!")),n.a.createElement("div",{className:"headline centered"},n.a.createElement("p",null,"Remote access successful. Youâ€™ve been granted access to Oâ€™Reilly Learning.")),n.a.createElement("div",{className:"messaging centered"},n.a.createElement("p",null,"Please note that because youâ€™re using a library-based subscription, any personalized features used during this session will not be saved.")),n.a.createElement("div",{className:"buttonBox"},"loading"===t?n.a.createElement("img",{className:"spinner",src:"/library/view/static/images/loading.gif",alt:""}):n.a.createElement("button",{className:"cta",onClick:this.registerTemporaryUser},"Let's Go")))}},{key:"renderPrivacyPolicy",value:function(){return n.a.createElement("p",{className:"privacyPolicy"},"We will use your personal data in accordance with our ",n.a.createElement("a",{href:"https://www.oreilly.com/privacy.html"},"Privacy Policy"),".")}},{key:"renderFederated",value:function(){this.props.env;var e=this.state,t=e.federatedInstitution,r=e.universityLogo,a=e.targetUrl,i=e.mlfaIDPProviders;return n.a.createElement(d,{universityLogo:r},n.a.createElement("div",{className:"attention"},n.a.createElement("p",null,"Welcome! Get instant access through ",n.a.createElement("span",{className:"nowrap"},"your library."))),n.a.createElement("div",{className:"messaging federatedMessage"},n.a.createElement("select",{className:"styled",onChange:this.handleFederatedSelectionChange,defaultValue:""},n.a.createElement("option",{key:"",value:"",disabled:!0,hidden:!0},"Select your institution"),Object.keys(i).map(function(e){return n.a.createElement("option",{key:e,"data-key":e,value:i[e].slug},i[e].name)})),n.a.createElement("div",{className:t?"":"hidden"},n.a.createElement("p",null,"Your institution is set up for seamless Federated access:"),n.a.createElement("div",{id:"federatedLoginButtonInternal"},n.a.createElement("a",{className:"shibboleth",href:a},"Sign In with my Institution"))),n.a.createElement("div",{className:"institutionLink",onClick:this.handleInstitutionNotListed},"Institution not listed?"),this.renderPrivacyPolicy()))}},{key:"renderSuccessMessage",value:function(){var e=this.state.universityLogo;return n.a.createElement(d,{className:"successModal",universityLogo:e},n.a.createElement("div",{className:"attention"},n.a.createElement("p",null,"Welcome to the O'Reilly Learning Platform!")),n.a.createElement("div",{className:"messaging centered"},n.a.createElement("p",null,"Your institution provides you free access to our 35K+ books, 30K+ hours of video, curated learning paths, case studies, interactive tutorials, audio books, and O'Reilly conference videos!")),n.a.createElement("div",{className:"buttonBox"},n.a.createElement("a",{className:"cta",href:this.fullLearningURL(this.props.readingUrl)},"Got It")))}},{key:"renderFailureMessage",value:function(){var e=this.state,t=e.ipAuth,r=e.referrerAuth,a=e.tld,i=e.universityLogo,o="https://www.oreilly.".concat(a,"/online-learning/support/");return n.a.createElement(d,{universityLogo:i},n.a.createElement("div",{className:"attention centered error"},n.a.createElement("div",null,n.a.createElement("img",{className:"error-alert",src:"/library/view/static/images/icons/exclamation-alert.svg",alt:"Alert"})),t?"":n.a.createElement("p",null,"An error has occurred with the site.")),n.a.createElement("div",{className:"messaging centered error"},t||r?n.a.createElement("p",null,"Hmmâ€¦ We've verified your remote access, but we're unable to activate your account. Could you give us a few and then try again? If that still doesn't work, please ",n.a.createElement("a",{href:o},"contact our customer service team for help"),"."):n.a.createElement("p",null,"Please go back and re-enter your email address.")),n.a.createElement("div",{className:"buttonBox"},n.a.createElement("button",{className:"cta",onClick:function(){return window.location.reload(!0)}},"Try Again")))}},{key:"renderSsoMessage",value:function(){var e=this.state.universityLogo;return n.a.createElement(d,{className:"ssoModal",universityLogo:e},n.a.createElement("div",{className:"attention centered"},n.a.createElement("p",null,"Welcome to the O'Reilly Learning Platform!")),n.a.createElement("div",{className:"messaging centered"},n.a.createElement("p",null,"You have a free Safari account, courtesy of this library. Please wait while we connect.")))}},{key:"renderIdProviderSelector",value:function(){var e=this.state,t=e.uiState,r=e.universityLogo,a=e.idProviders;return n.a.createElement(d,{universityLogo:r},n.a.createElement("div",{className:"attention"},n.a.createElement("p",null,"Iâ€™m with:")),n.a.createElement("div",{className:"messaging federatedMessage"},n.a.createElement("select",{className:"styled",onChange:this.handleIdProviderSelection,defaultValue:""},n.a.createElement("option",{key:"",value:"",disabled:!0,hidden:!0},"Select your institution"),Object.keys(a).map(function(e){return n.a.createElement("option",{key:e,"data-key":e,value:a[e].sso_link_base_url},a[e].display_name)}))),n.a.createElement("div",{className:"buttonBox"},"loading"===t?n.a.createElement("img",{className:"spinner",src:"/library/view/static/images/loading.gif",alt:""}):n.a.createElement("button",{className:"cta",onClick:this.redirectToChosenIdProvider},"Let's Go")))}},{key:"handleIdProviderSelection",value:function(e){this.setState({chosenIdProvider:e.target.value})}},{key:"redirectToChosenIdProvider",value:function(e){"other"===e.target.value?this.setState({uiState:"showIdProviderSelector"}):this.redirectToSsoLoginUrl(this.state.chosenIdProvider)}},{key:"render",value:function(){var e=this.state,t=e.ipAuth,r=e.referrerAuth,a=e.show,n=e.uiState;return a?"ezproxy-sso"==n?this.renderSsoMessage():"success"===n?this.renderSuccessMessage():"failure"===n?this.renderFailureMessage():"sso"===n?this.renderSsoMessage():"federated"===n?this.renderFederated(!1):"ipVerified"===n||t?this.renderTempVerified():"referrerVerified"===n||r?this.renderTempVerified():"showIdProviderSelector"===n?this.renderIdProviderSelector():this.renderEmailEntry():null}}])&&_defineProperties(t.prototype,r),i&&_defineProperties(t,i),StudentIntercept}();h.propTypes={readingUrl:c.a.string.isRequired,signInUrl:c.a.string.isRequired,forceShow:c.a.bool.isRequired,ssoMsgTimeoutMs:c.a.number.isRequired};var f=h,p=new s.a(window.location.search),v=document.getElementsByTagName("html")[0],y={accountIdentifier:v.getAttribute("data-account-identifier"),env:v.getAttribute("data-env"),federatedAuthEnabled:v.getAttribute("data-federated-auth-enabled"),forceShow:window.location.href.search(/\?ar/)>=0||parseInt(v.getAttribute("data-force-show"),10)>0||v.getAttribute("data-account-identifier"),readingUrl:p.get("next")||v.getAttribute("data-reading-url")||v.getAttribute("data-url"),signInUrl:"/member/login/?next=".concat(p.get("next")||v.getAttribute("data-url")),ssoMsgTimeoutMs:4e3},g=document.createElement("div");g.id="academic-modal",document.getElementsByTagName("body")[0].appendChild(g),Object(i.render)(n.a.createElement(f,y),g)}});;